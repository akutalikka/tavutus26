<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <title>Suomen kielen tavuttaja - Offline-versio</title>
    <style>
        body { font-family: sans-serif; max-width: 700px; margin: 40px auto; padding: 20px; background-color: #f4f7f6; color: #333; }
        .box { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 100px; margin: 10px 0; padding: 12px; box-sizing: border-box; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; }
        button { background: #007bff; color: white; border: none; padding: 15px; width: 100%; cursor: pointer; border-radius: 6px; font-weight: bold; font-size: 18px; transition: 0.2s; }
        button:hover { background: #0056b3; }
        .output-group { margin-top: 25px; padding: 15px; background: #fff; border: 1px dashed #ccc; border-radius: 8px; }
        .output { font-size: 1.3rem; line-height: 1.6; word-wrap: break-word; }
        .blue { color: #0056b3; font-weight: bold; }
        .red { color: #d9534f; font-weight: bold; }
        h4 { margin: 0 0 10px 0; color: #666; font-size: 0.9rem; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="box">
    <h2>Suomen kielen tavuttaja</h2>
    <textarea id="input" placeholder="Syötä suomenkielinen lause tähän..."></textarea>
    <button onclick="ajaTavutus()">TAVUTA TEKSTI</button>

    <div id="results" style="display:none;">
        <div class="output-group">
            <h4>Tavuviivoilla:</h4>
            <div id="viivat" class="output"></div>
        </div>

        <div class="output-group">
            <h4>Väreillä:</h4>
            <div id="varit" class="output"></div>
        </div>
    </div>
</div>

<script>
/**
 * MINIMAL HYPHER CORE ENGINE
 * Sisältää tarvittavat toiminnot tavutukseen ilman ulkoisia kirjastoja.
 */
const SimpleTavuttaja = {
    // Suomen kielen perussääntöjä mukailevat tavutuskuviot
    patterns: {"2a1":1,"2e1":1,"2i1":1,"2o1":1,"2u1":1,"2y1":1,"2ä1":1,"2ö1":1,"ba1":1,"be1":1,"bi1":1,"bo1":1,"bu1":1,"by1":1,"bä1":1,"bö1":1,"da1":1,"de1":1,"di1":1,"do1":1,"du1":1,"dy1":1,"dä1":1,"dö1":1,"fa1":1,"fe1":1,"fi1":1,"fo1":1,"fu1":1,"fy1":1,"fä1":1,"fö1":1,"ga1":1,"ge1":1,"gi1":1,"go1":1,"gu1":1,"gy1":1,"gä1":1,"gö1":1,"ha1":1,"he1":1,"hi1":1,"ho1":1,"hu1":1,"hy1":1,"hä1":1,"hö1":1,"ja1":1,"je1":1,"ji1":1,"jo1":1,"ju1":1,"jy1":1,"jä1":1,"jö1":1,"ka1":1,"ke1":1,"ki1":1,"ko1":1,"ku1":1,"ky1":1,"kä1":1,"kö1":1,"la1":1,"le1":1,"li1":1,"lo1":1,"lu1":1,"ly1":1,"lä1":1,"lö1":1,"ma1":1,"me1":1,"mi1":1,"mo1":1,"mu1":1,"my1":1,"mä1":1,"mö1":1,"na1":1,"ne1":1,"ni1":1,"no1":1,"nu1":1,"ny1":1,"nä1":1,"nö1":1,"pa1":1,"pe1":1,"pi1":1,"po1":1,"pu1":1,"py1":1,"pä1":1,"pö1":1,"ra1":1,"re1":1,"ri1":1,"ro1":1,"ru1":1,"ry1":1,"rä1":1,"rö1":1,"sa1":1,"se1":1,"si1":1,"so1":1,"su1":1,"sy1":1,"sä1":1,"sö1":1,"ta1":1,"te1":1,"ti1":1,"to1":1,"tu1":1,"ty1":1,"tä1":1,"tö1":1,"va1":1,"ve1":1,"vi1":1,"vo1":1,"vu1":1,"vy1":1,"vä1":1,"vö1":1},

    hyphenate: function(word) {
        if (word.length < 4) return [word];
        let levels = new Array(word.length + 1).fill(0);
        let lowWord = "_" + word.toLowerCase() + "_";
        
        for (let i = 0; i < lowWord.length; i++) {
            for (let j = i + 2; j <= lowWord.length; j++) {
                let sub = lowWord.substring(i, j);
                let pat = sub.replace(/[0-9]/g, "");
                let val = this.patterns[sub] || 0;
                
                // Tarkistetaan löytyykö tavutuskuvio (yksinkertaistettu haku)
                for (let k in this.patterns) {
                    if (k.replace(/[0-9]/g, "") === sub) {
                        let level = 0, pos = 0;
                        for (let n = 0; n < k.length; n++) {
                            if (/[0-9]/.test(k[n])) {
                                level = parseInt(k[n]);
                                if (level > levels[i + pos]) levels[i + pos] = level;
                            } else {
                                pos++;
                            }
                        }
                    }
                }
            }
        }

        let result = [];
        let start = 0;
        for (let i = 1; i < word.length; i++) {
            if (levels[i+1] % 2 !== 0 && i > 1 && i < word.length - 1) {
                result.push(word.substring(start, i));
                start = i;
            }
        }
        result.push(word.substring(start));
        return result;
    }
};

function ajaTavutus() {
    const teksti = document.getElementById('input').value;
    const osat = teksti.split(/(\s+)/);
    
    let vTulos = "";
    let cTulos = "";

    osat.forEach(osa => {
        if (osa.trim().length === 0) {
            vTulos += osa;
            cTulos += osa;
        } else {
            // Irrotetaan välimerkit
            const puhdasSana = osa.replace(/[.,!?;:()]/g, "");
            const valimerkitLopus = osa.slice(puhdasSana.length);
            
            const tavut = SimpleTavuttaja.hyphenate(puhdasSana);
            
            // Viivallinen
            vTulos += tavut.join("-") + valimerkitLopus;
            
            // Väritetty
            tavut.forEach((tavu, i) => {
                const vari = (i % 2 === 0) ? 'blue' : 'red';
                let loppu = (i === tavut.length - 1) ? valimerkitLopus : "";
                cTulos += `<span class="${vari}">${tavu}</span>${loppu}`;
            });
        }
    });

    document.getElementById('viivat').innerText = vTulos;
    document.getElementById('varit').innerHTML = cTulos;
    document.getElementById('results').style.display = 'block';
}
</script>

</body>
</html>
